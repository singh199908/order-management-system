<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - Order Management System</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f5f5f5;
            padding: 20px;
        }
        
        .header {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        h1 {
            color: #333;
        }
        
        .header-left {
            display: flex;
            gap: 20px;
            align-items: center;
        }

        .header-right {
            display: flex;
            gap: 20px;
            align-items: center;
        }
        
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            text-decoration: none;
            display: inline-block;
            transition: all 0.3s;
        }
        
        .btn-logout {
            background: #dc3545;
            color: white;
        }
        
        .btn-logout:hover {
            background: #c82333;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            background: white;
            padding: 10px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .tab {
            padding: 10px 20px;
            background: #e0e0e0;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
        }
        
        .tab.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .card {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        
        .card h2 {
            margin-bottom: 20px;
            color: #333;
        }
        
        .notifications-panel {
            max-height: 400px;
            overflow-y: auto;
        }
        
        .notification {
            padding: 15px;
            border-left: 4px solid #667eea;
            background: #f8f9fa;
            margin-bottom: 10px;
            border-radius: 4px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .notification.read {
            opacity: 0.6;
            border-left-color: #ccc;
        }
        
        .notification-info {
            flex: 1;
        }
        
        .notification-time {
            color: #666;
            font-size: 12px;
            margin-top: 5px;
        }
        
        .btn-mark-read {
            padding: 5px 15px;
            background: #28a745;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
        }
        
        .orders-table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .orders-table th,
        .orders-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #eee;
        }
        
        .orders-table th {
            background: #f8f9fa;
            font-weight: 600;
            color: #333;
        }
        
        .orders-table tr:hover {
            background: #f8f9fa;
        }
        
        .status-badge {
            padding: 5px 10px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
        }
        
        .status-pending {
            background: #fff3cd;
            color: #856404;
        }
        
        .status-confirmed {
            background: #d1ecf1;
            color: #0c5460;
        }
        
        .status-completed {
            background: #d4edda;
            color: #155724;
        }
        
        .status-downloaded {
            background: #cce5ff;
            color: #004085;
        }
        
        .btn-download {
            padding: 5px 15px;
            background: #28a745;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            text-decoration: none;
            display: inline-block;
            margin-right: 5px;
        }
        
        .btn-sheet {
            padding: 5px 15px;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            text-decoration: none;
            display: inline-block;
            margin-right: 5px;
        }
        
        .btn-sheet:hover {
            background: #0069d9;
        }
        
        .btn-download:hover {
            background: #218838;
        }
        
        .btn-delete {
            padding: 5px 15px;
            background: #dc3545;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            text-decoration: none;
            display: inline-block;
        }
        
        .btn-delete:hover {
            background: #c82333;
        }
        
        .upload-section {
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        
        .file-input-wrapper {
            position: relative;
            display: inline-block;
            width: 100%;
        }
        
        .file-input-wrapper input[type="file"] {
            width: 100%;
            padding: 10px;
            border: 2px dashed #667eea;
            border-radius: 5px;
            background: white;
            cursor: pointer;
        }
        
        .btn-upload {
            padding: 12px 30px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            margin-top: 15px;
            transition: transform 0.2s;
        }
        
        .btn-upload:hover {
            transform: translateY(-2px);
        }
        
        .btn-upload:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        
        .products-table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .products-table th,
        .products-table td {
            padding: 10px;
            text-align: left;
            border-bottom: 1px solid #eee;
            font-size: 14px;
        }
        
        .products-table th {
            background: #f8f9fa;
            font-weight: 600;
        }
        
        .create-ba-section {
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 5px;
            color: #333;
            font-weight: 500;
        }
        
        .form-group input {
            width: 100%;
            padding: 10px;
            border: 2px solid #e0e0e0;
            border-radius: 5px;
            font-size: 14px;
        }
        
        .form-group input:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .btn-create {
            padding: 10px 20px;
            background: #28a745;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
        }
        
        .btn-create:hover {
            background: #218838;
        }
        
        .alert {
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .alert-success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .alert-error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .order-details {
            margin-top: 10px;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 5px;
            font-size: 12px;
        }
        
        .order-details-item {
            padding: 5px 0;
            border-bottom: 1px solid #ddd;
        }
        
        .order-details-item:last-child {
            border-bottom: none;
        }
        
        /* Mobile and Tablet Responsive Styles */
        @media (max-width: 768px) {
            body {
                padding: 10px;
            }
            
            .header {
                flex-direction: column;
                gap: 15px;
                padding: 15px;
            }
            
            .header-left,
            .header-right {
                flex-direction: column;
                width: 100%;
                gap: 10px;
            }
            
            .header-left .btn,
            .header-right .btn {
                width: 100%;
            }
            
            .tabs {
                flex-wrap: wrap;
                gap: 5px;
            }
            
            .tab {
                padding: 8px 15px;
                font-size: 12px;
                flex: 1;
                min-width: 100px;
            }
            
            .card {
                padding: 15px;
            }
            
            .orders-table {
                display: block;
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
            }
            
            .orders-table thead,
            .orders-table tbody,
            .orders-table tr,
            .orders-table td,
            .orders-table th {
                display: block;
            }
            
            .orders-table thead {
                display: none;
            }
            
            .orders-table tr {
                border: 1px solid #ddd;
                margin-bottom: 10px;
                padding: 10px;
                background: white;
                border-radius: 5px;
            }
            
            .orders-table td {
                border: none;
                padding: 8px;
                text-align: right;
                position: relative;
                padding-left: 50%;
            }
            
            .orders-table td:before {
                content: attr(data-label);
                position: absolute;
                left: 8px;
                font-weight: 600;
                text-align: left;
            }
            
            .form-group {
                margin-bottom: 15px;
            }
            
            .form-group input,
            .form-group textarea {
                width: 100%;
                font-size: 16px; /* Prevents zoom on iOS */
            }
            
            .btn-download,
            .btn-delete {
                width: 100%;
                margin: 5px 0;
            }
            
            .notification {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }
            
            .products-grid {
                grid-template-columns: 1fr;
            }
        }
        
        @media (max-width: 480px) {
            body {
                padding: 5px;
            }
            
            .header {
                padding: 10px;
            }
            
            .header h1 {
                font-size: 18px;
            }
            
            .tabs {
                flex-direction: column;
            }
            
            .tab {
                width: 100%;
            }
            
            .card {
                padding: 10px;
            }
            
            .card h2 {
                font-size: 18px;
            }
            
            .upload-section {
                padding: 15px;
            }
        }
        
        /* Tablet Styles */
        @media (min-width: 769px) and (max-width: 1024px) {
            .orders-table {
                font-size: 14px;
            }
            
            .orders-table th,
            .orders-table td {
                padding: 10px 8px;
            }
            
            .card {
                padding: 15px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="header-left">
                <a href="{{ url_for('order_page') }}" class="btn" style="background: #667eea; color: white;">Home</a>
                <span>Welcome, <strong>{{ session.username }}</strong></span>
            </div>
            <div class="header-right">
                <a href="{{ url_for('my_orders') }}" class="btn" style="background: #6c757d; color: white;">Order History</a>
                <a href="{{ url_for('logout') }}" class="btn btn-logout">Logout</a>
            </div>
        </div>
        
        <div id="alert-container"></div>
        
        <div class="tabs">
            <button class="tab active" onclick="switchTab('notifications')">Notifications</button>
            <button class="tab" onclick="switchTab('orders')">Orders</button>
            <button class="tab" onclick="switchTab('products')">Products</button>
            <button class="tab" onclick="switchTab('stock')">Update Stock</button>
            <button class="tab" onclick="switchTab('create-ba')">Create BA</button>
            <button class="tab" onclick="switchTab('whatsapp-settings')">WhatsApp Settings</button>
        </div>
        
        <!-- Notifications Tab -->
        <div id="notifications" class="tab-content active">
            <div class="card">
                <h2>Recent Notifications</h2>
                <div id="notifications-list" class="notifications-panel">
                    <div class="loading">Loading notifications...</div>
                </div>
            </div>
        </div>
        
        <!-- Orders Tab -->
        <div id="orders" class="tab-content">
            <div class="card">
                <h2>All Orders</h2>
                <div id="orders-list">
                    <div class="loading">Loading orders...</div>
                </div>
            </div>
        </div>
        
        <!-- Products Tab -->
        <div id="products" class="tab-content">
            <div class="card">
                <h2>Product Inventory</h2>
                <div id="products-list">
                    <div class="loading">Loading products...</div>
                </div>
            </div>
        </div>
        
        <!-- Update Stock Tab -->
        <div id="stock" class="tab-content">
            <div class="card">
                <h2>Update Stock from Excel</h2>
                <div class="upload-section">
                    <p style="margin-bottom: 15px; color: #666;">
                        Upload an Excel file (.xlsx or .xls) with the following columns:<br>
                        <strong>Lot Type Code, Parent Code, Item Lot Type: Lot Type, Quantity Available, MRP</strong>
                    </p>
                    <div class="file-input-wrapper">
                        <input type="file" id="stock-file" accept=".xlsx,.xls">
                    </div>
                    <button id="upload-btn" class="btn-upload" onclick="uploadStock()">Upload and Update Stock</button>
                </div>
            </div>
        </div>
        
        <!-- Create BA Tab -->
        <div id="create-ba" class="tab-content">
            <div class="card">
                <h2>Create New BA Account</h2>
                <div class="create-ba-section">
                    <div class="form-group">
                        <label for="ba-username">Username</label>
                        <input type="text" id="ba-username" placeholder="Enter username">
                    </div>
                    <div class="form-group">
                        <label for="ba-password">Password</label>
                        <input type="password" id="ba-password" placeholder="Enter password">
                    </div>
                    <button class="btn-create" onclick="createBA()">Create BA Account</button>
                </div>
            </div>
        </div>
        
        <!-- WhatsApp Settings Tab -->
        <div id="whatsapp-settings" class="tab-content">
            <div class="card">
                <h2>WhatsApp Notification Settings</h2>
                <div class="create-ba-section">
                    <p style="margin-bottom: 20px; color: #666;">
                        Configure WhatsApp notifications using Twilio Content Templates. You'll need:
                        <br>1. Twilio Account SID
                        <br>2. Twilio Auth Token
                        <br>3. Twilio WhatsApp number (sandbox or approved)
                        <br>4. Your WhatsApp number (with country code, e.g., +916392104804)
                        <br>5. Content SID (Template ID)
                    </p>
                    <div class="form-group">
                        <label for="twilio-sid">Twilio Account SID</label>
                        <input type="text" id="twilio-sid" placeholder="Enter your Twilio Account SID" value="">
                    </div>
                    <div class="form-group">
                        <label for="twilio-token">Twilio Auth Token</label>
                        <input type="password" id="twilio-token" placeholder="Enter Twilio Auth Token">
                    </div>
                    <div class="form-group">
                        <label for="twilio-from">Twilio WhatsApp From (e.g., whatsapp:+14155238886)</label>
                        <input type="text" id="twilio-from" placeholder="whatsapp:+14155238886" value="whatsapp:+14155238886">
                    </div>
                    <div class="form-group">
                        <label for="admin-whatsapp">Your WhatsApp Number (with country code)</label>
                        <input type="text" id="admin-whatsapp" placeholder="+916392104804" value="+916392104804">
                    </div>
                    <div class="form-group">
                        <label for="content-sid">Content SID (Template ID)</label>
                        <input type="text" id="content-sid" placeholder="HXb5b62575e6e4ff6129ad7c8efe1f983e" value="HXb5b62575e6e4ff6129ad7c8efe1f983e">
                    </div>
                    <button class="btn-create" onclick="testWhatsApp()" style="background: #17a2b8; margin-right: 10px;">Test WhatsApp</button>
                    <button class="btn-create" onclick="saveWhatsAppSettings()">Save Settings</button>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        function switchTab(tabName) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Show selected tab
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
            
            // Load data for the tab
            if (tabName === 'notifications') {
                loadNotifications();
            } else if (tabName === 'orders') {
                loadOrders();
            } else if (tabName === 'products') {
                loadProducts();
            }
        }
        
        async function loadNotifications() {
            try {
                const response = await fetch('/admin/notifications');
                const notifications = await response.json();
                
                const container = document.getElementById('notifications-list');
                
                if (notifications.length === 0) {
                    container.innerHTML = '<div style="text-align: center; color: #999; padding: 40px;">No notifications</div>';
                    return;
                }
                
                container.innerHTML = notifications.map(n => `
                    <div class="notification ${n.read ? 'read' : ''}">
                        <div class="notification-info">
                            <div>${n.message}</div>
                            <div class="notification-time">${n.created_at}</div>
                        </div>
                        ${!n.read ? `<button class="btn-mark-read" onclick="markRead(${n.id})">Mark as Read</button>` : ''}
                    </div>
                `).join('');
            } catch (error) {
                document.getElementById('notifications-list').innerHTML = 
                    '<div class="alert alert-error">Error loading notifications</div>';
            }
        }
        
        async function markRead(notificationId) {
            try {
                const response = await fetch(`/admin/mark_notification_read/${notificationId}`, {
                    method: 'POST'
                });
                
                if (response.ok) {
                    loadNotifications();
                }
            } catch (error) {
                showAlert('Error marking notification as read', 'error');
            }
        }
        
        async function loadOrders() {
            try {
                const response = await fetch('/admin/orders');
                const orders = await response.json();
                
                const container = document.getElementById('orders-list');
                
                if (orders.length === 0) {
                    container.innerHTML = '<div style="text-align: center; color: #999; padding: 40px;">No orders yet</div>';
                    return;
                }
                
                container.innerHTML = `
                    <table class="orders-table">
                        <thead>
                            <tr>
                                <th>Order ID</th>
                                <th>BA Username</th>
                                <th>Items</th>
                                <th>Total Amount</th>
                                <th>Status</th>
                                <th>Date</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${orders.map(order => `
                                <tr>
                                    <td data-label="Order ID">#${order.id}</td>
                                    <td data-label="BA Username">${order.username}</td>
                                    <td data-label="Items">
                                        <div class="order-details">
                                            ${order.order_data.map(item => `
                                                <div class="order-details-item">
                                                    ${item.lot_type_code} - Qty: ${item.quantity} √ó ‚Çπ${item.mrp}
                                                </div>
                                            `).join('')}
                                        </div>
                                    </td>
                                    <td data-label="Total Amount">‚Çπ${order.total_amount.toFixed(2)}</td>
                                    <td data-label="Status"><span class="status-badge status-${order.status}">${order.status}</span></td>
                                    <td data-label="Date">${order.created_at}</td>
                                    <td data-label="Actions">
                                        ${order.sheet_url ? `
                                            <a href="${order.sheet_url}" class="btn-sheet" target="_blank" rel="noopener noreferrer">
                                                üìÑ Sheet
                                            </a>
                                        ` : ''}
                                        <a href="/admin/download_order/${order.id}" class="btn-download" onclick="handleDownload(${order.id}, event)">
                                            üì• Download
                                        </a>
                                        <button class="btn-delete" onclick="deleteOrder(${order.id})">
                                            üóëÔ∏è Delete
                                        </button>
                                    </td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                `;
            } catch (error) {
                document.getElementById('orders-list').innerHTML = 
                    '<div class="alert alert-error">Error loading orders</div>';
            }
        }
        
        async function loadProducts() {
            try {
                const response = await fetch('/api/products');
                const products = await response.json();
                
                const container = document.getElementById('products-list');
                
                if (products.length === 0) {
                    container.innerHTML = '<div style="text-align: center; color: #999; padding: 40px;">No products</div>';
                    return;
                }
                
                container.innerHTML = `
                    <table class="products-table">
                        <thead>
                            <tr>
                                <th>Lot Type Code</th>
                                <th>Parent Code</th>
                                <th>Item Lot Type</th>
                                <th>Quantity Available</th>
                                <th>MRP</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${products.map(p => `
                                <tr>
                                    <td>${p.lot_type_code}</td>
                                    <td>${p.parent_code || 'N/A'}</td>
                                    <td>${p.item_lot_type || 'N/A'}</td>
                                    <td>${p.quantity_available}</td>
                                    <td>‚Çπ${p.mrp || '0.00'}</td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                `;
            } catch (error) {
                document.getElementById('products-list').innerHTML = 
                    '<div class="alert alert-error">Error loading products</div>';
            }
        }
        
        async function uploadStock() {
            const fileInput = document.getElementById('stock-file');
            const uploadBtn = document.getElementById('upload-btn');
            
            if (!fileInput.files.length) {
                showAlert('Please select a file', 'error');
                return;
            }
            
            const formData = new FormData();
            formData.append('file', fileInput.files[0]);
            
            uploadBtn.disabled = true;
            uploadBtn.textContent = 'Uploading...';
            
            try {
                const response = await fetch('/admin/upload_stock', {
                    method: 'POST',
                    body: formData
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    showAlert(data.message, 'success');
                    fileInput.value = '';
                    loadProducts(); // Refresh products list
                } else {
                    showAlert(data.error || 'Error uploading file', 'error');
                }
            } catch (error) {
                showAlert('Error uploading file. Please try again.', 'error');
            } finally {
                uploadBtn.disabled = false;
                uploadBtn.textContent = 'Upload and Update Stock';
            }
        }
        
        async function createBA() {
            const username = document.getElementById('ba-username').value;
            const password = document.getElementById('ba-password').value;
            
            if (!username || !password) {
                showAlert('Please enter both username and password', 'error');
                return;
            }
            
            try {
                const response = await fetch('/admin/create_ba', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ username, password })
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    showAlert(data.message, 'success');
                    document.getElementById('ba-username').value = '';
                    document.getElementById('ba-password').value = '';
                } else {
                    showAlert(data.error || 'Error creating BA account', 'error');
                }
            } catch (error) {
                showAlert('Error creating BA account. Please try again.', 'error');
            }
        }
        
        function handleDownload(orderId, event) {
            // Let the link work normally, but we'll update the status after download
            // The server will update the status when the download is triggered
            setTimeout(() => {
                loadOrders(); // Reload orders to show updated status
            }, 1000);
        }
        
        async function deleteOrder(orderId) {
            if (!confirm(`Are you sure you want to delete Order #${orderId}? This action cannot be undone.`)) {
                return;
            }
            
            try {
                const response = await fetch(`/admin/delete_order/${orderId}`, {
                    method: 'DELETE'
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    showAlert(data.message || 'Order deleted successfully', 'success');
                    loadOrders(); // Reload orders list
                } else {
                    showAlert(data.error || 'Error deleting order', 'error');
                }
            } catch (error) {
                console.error('Error deleting order:', error);
                showAlert('Error deleting order. Please try again.', 'error');
            }
        }
        
        async function testWhatsApp() {
            const accountSid = document.getElementById('twilio-sid').value;
            const authToken = document.getElementById('twilio-token').value;
            const fromNumber = document.getElementById('twilio-from').value;
            const toNumber = document.getElementById('admin-whatsapp').value;
            const contentSid = document.getElementById('content-sid').value;
            
            if (!accountSid || !authToken || !fromNumber || !toNumber || !contentSid) {
                showAlert('Please fill in all fields', 'error');
                return;
            }
            
            try {
                const response = await fetch('/admin/whatsapp/test', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        account_sid: accountSid,
                        auth_token: authToken,
                        from_number: fromNumber,
                        to_number: toNumber,
                        content_sid: contentSid
                    })
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    showAlert(data.message, 'success');
                } else {
                    showAlert(data.error || 'Error sending test message', 'error');
                }
            } catch (error) {
                showAlert('Error sending test message. Please try again.', 'error');
            }
        }
        
        async function saveWhatsAppSettings() {
            const accountSid = document.getElementById('twilio-sid').value;
            const authToken = document.getElementById('twilio-token').value;
            const fromNumber = document.getElementById('twilio-from').value;
            const toNumber = document.getElementById('admin-whatsapp').value;
            const contentSid = document.getElementById('content-sid').value;
            
            try {
                const response = await fetch('/admin/whatsapp/settings', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        account_sid: accountSid,
                        auth_token: authToken,
                        from_number: fromNumber,
                        to_number: toNumber,
                        content_sid: contentSid
                    })
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    showAlert(data.message, 'success');
                } else {
                    showAlert(data.error || 'Error saving settings', 'error');
                }
            } catch (error) {
                showAlert('Error saving settings. Please try again.', 'error');
            }
        }
        
        function showAlert(message, type) {
            const alertContainer = document.getElementById('alert-container');
            alertContainer.innerHTML = `<div class="alert alert-${type}">${message}</div>`;
            setTimeout(() => {
                alertContainer.innerHTML = '';
            }, 5000);
        }
        
        // Load notifications on page load
        loadNotifications();
    </script>
</body>
</html>

